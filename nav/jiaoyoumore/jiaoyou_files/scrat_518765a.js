!function(e){"use strict";function t(e){return e=e.slice(),function(){r(e,function(e){for(e.loaded=!0;e.onload.length;){var t=e.onload.shift();t.call(e)}})}}function n(e){var t=f.alias(e),o=f.get(t);if("js"===i(t)){if(!o)throw new Error('failed to require "'+e+'"');if(!o.exports){if("function"!==a(o.factory))throw new Error('failed to require "'+e+'"');try{o.factory.call(f,n,o.exports={},o)}catch(r){throw r.id=t,f.traceback=r}delete o.factory,l("require","["+t+"] factory called")}return o.exports}}function o(e){var t=f.alias(e),n=f.get(t);if("css"===i(t)){if(!n)throw new Error('failed to require "'+e+'"');if(!n.parsed){if("string"!==a(n.rawCSS))throw new Error('failed to require "'+e+'"');var o=document.createElement("style");document.head.appendChild(o),o.appendChild(document.createTextNode(n.rawCSS)),delete n.rawCSS,n.parsed=!0}}}function a(e){var t;return null==e?t=String(e):(t=Object.prototype.toString.call(e).toLowerCase(),t=t.substring(8,t.length-1)),t}function r(e,t,n){if("object"==typeof e){var o,r,c=a(e);if(n=n||e,"array"===c||"arguments"===c||"nodelist"===c){for(o=0,r=e.length;r>o;o++)if(t.call(n,e[o],o,e)===!1)return}else for(o in e)if(e.hasOwnProperty(o)&&t.call(n,e[o],o,e)===!1)return}}function c(e){function t(){}return t.prototype=e,new t}function i(e){var t="js";return e.replace(g,function(e,n){t=n}),"js"!==t&&"css"!==t&&(t="unknown"),t}function l(){var t=(e.localStorage||{}).debug,n=s.call(arguments),o="color: #bada55",r=n.shift(),c=new RegExp(r.replace(/[.\/\\]/g,function(e){return"\\"+e}));r="%c"+r,(t&&"*"===t||c.test(t))&&(p!==r&&(console.groupEnd(p,o),console.group(p=r,o)),/string|number|boolean/.test(a(n[0]))&&(n[0]="%c"+n[0],n.splice(1,0,o)),console.log.apply(console,n))}var s=Array.prototype.slice,d=e.localStorage,u={},f=c(u);f.version="0.3.5",f.options={prefix:"__SCRAT__",cache:!1,hash:"",timeout:15,alias:{},deps:{},urlPattern:null,comboPattern:null,combo:!1,maxUrlLength:2e3},f.cache={},f.traceback=null,u.config=function(e){var t=f.options;l("scrat.config",e),r(e,function(e,n){var o=t[n],c=a(o);"object"===c?r(e,function(e,t){o[t]=e}):("array"===c&&(e=o.concat(e)),t[n]=e)});try{t.hash!==d.getItem("__SCRAT_HASH__")&&(f.clean(),d.setItem("__SCRAT_HASH__",t.hash)),t.cache=t.cache&&!!t.hash}catch(n){t.cache=!1}return/\bscrat=([\w,]+)\b/.test(location.search)&&r(RegExp.$1.split(","),function(e){switch(e){case"nocache":f.clean(),t.cache=!1;break;case"nocombo":t.combo=!1}}),t},u.async=function(e,t){"string"===a(e)&&(e=[e]),l("scrat.async","require ["+e.join(", ")+"]");var o=new f.Reactor(e,function(){var o=[];r(e,function(e){o.push(n(e))}),t&&t.apply(f,o),l("scrat.async","["+e.join(", ")+"] callback called")});o.run()},u.define=function(e,t){l("scrat.define","["+e+"]");var n=f.options,o=f.cache[e];o?o.factory=t:f.cache[e]={id:e,loaded:!0,factory:t},n.cache&&d.setItem(n.prefix+e,t.toString())},u.defineCSS=function(e,t,n){l("scrat.defineCSS","["+e+"]");var a=f.options;f.cache[e]={id:e,loaded:!0,rawCSS:t},n!==!1&&o(e),a.cache&&d.setItem(a.prefix+e,t)},u.get=function(t){l("scrat.get","["+t+"]");var n,o=f.options,a=i(t),r=f.cache[t];return r?r:o.cache&&(n=d.getItem(o.prefix+t))?("js"===a?e.eval.call(e,'define("'+t+'",'+n+")"):"css"===a&&f.defineCSS(t,n,!1),f.cache[t].loaded=!1,f.cache[t]):null},u.clean=function(){l("scrat.clean");try{r(d,function(e,t){~t.indexOf(f.options.prefix)&&d.removeItem(t)}),d.removeItem("__SCRAT_HASH__")}catch(e){}},u.alias=function(e,t){var n=f.options.alias;if(arguments.length>1)return n[e]=t,f.alias(e);for(;n[e]&&e!==n[e];)switch(a(n[e])){case"function":e=n[e](e);break;case"string":e=n[e]}return e},u.load=function(e,t){"function"===a(t)&&(t={onload:t});var n,o,r=t.type||i(e),c="js"===r,s="css"===r,d=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,u=document.head,h=document.createElement(c?"script":"link"),p="onload"in h,g=setTimeout(onerror,1e3*(t.timeout||15));c?(h.type="text/javascript",h.async="async",h.src=e):(s&&(h.type="text/css",h.rel="stylesheet"),h.href=e),h.onload=h.onreadystatechange=function(){!h||h.readyState&&!/loaded|complete/.test(h.readyState)||(clearTimeout(g),h.onload=h.onreadystatechange=null,c&&u&&h.parentNode&&u.removeChild(h),t.onload&&t.onload.call(f),h=null)},h.onerror=function(){throw clearTimeout(g),clearInterval(n),new Error("Error loading url: "+e)},l("scrat.load","["+e+"]"),u.appendChild(h),s?(d||!p)&&(l("scrat.load","check css's loading status for compatible"),o=0,n=setInterval(function(){return(o+=20)>t.timeout||!h?(clearTimeout(g),void clearInterval(n)):void(h.sheet&&(clearTimeout(g),clearInterval(n),t.onload&&t.onload.call(f),h=null))},20)):c||t.onload&&t.onload.call(f)},u.Reactor=function(e,t){this.length=0,this.depends={},this.depended={},this.push.apply(this,e),this.callback=t};var h=f.Reactor.prototype;h.push=function(){function e(){0===--t.length&&t.callback()}var t=this,n=s.call(arguments);r(n,function(n){var a=f.alias(n),r=i(a),c=f.get(a);if(c){if(t.depended[a]||c.loaded)return}else c=f.cache[a]={id:a,loaded:!1,onload:[]};t.depended[a]=1,t.push.apply(t,f.options.deps[a]),"css"===r&&!c.rawCSS&&!c.parsed||"js"===r&&!c.factory&&!c.exports?((t.depends[r]||(t.depends[r]=[])).push(c),++t.length,c.onload.push(e)):c.rawCSS&&o(a)})},h.run=function(){var e=this,n=f.options,o=n.combo,a=this.depends;return 0===this.length?this.callback():(l("reactor.run",a),r(a.unknown,function(t){f.load(e.genUrl(t.id),function(){t.loaded=!0})}),l("reactor.run","combo: "+o),void(o?r(["css","js"],function(o){var c=0,i=[],l=[];r(a[o],function(r,s){c+r.id.length<n.maxUrlLength?(c+=r.id.length,i.push(r.id),l.push(r)):(f.load(e.genUrl(i),t(l)),c=r.id.length,i=[r.id],l=[r]),s===a[o].length-1&&f.load(e.genUrl(i),t(l))})}):r((a.css||[]).concat(a.js||[]),function(t){f.load(e.genUrl(t.id),function(){for(t.loaded=!0;t.onload.length;){var e=t.onload.shift();e.call(t)}})})))},h.genUrl=function(e){"string"===a(e)&&(e=[e]);var t=f.options,n=t.combo&&t.comboPattern||t.urlPattern;switch(t.cache&&"css"===i(e[0])&&r(e,function(t,n){e[n]=t+".js"}),a(n)){case"string":n=n.replace("%s",e.join(","));break;case"function":n=n(e);break;default:n=e.join(",")}return n+(~n.indexOf("?")?"&":"?")+t.hash},r(u,function(e,t){n[t]=e});var p,g=/\.(js|css)(?=[?&,]|$)/i;e.require=f,e.define=f.define,e.defineCSS=f.defineCSS,e.module&&e.module.exports&&(e.module.exports=f)}(this);